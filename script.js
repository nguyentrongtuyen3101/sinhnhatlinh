const friends = [
    { name: "Thanh PhÆ°Æ¡ng", img: "image/phuong.jpg", date: "2004-09-24" },
    { name: "Äáº¡t Äáº§n", img: "image/dat.jpg", date: "2004-08-04" },
    { name: "Thu Thá»§y", img: "image/thuy.jpg", date: "2004-05-25" },
    { name: "Tháº£o Chi", img: "image/chi.jpg", date: "2004-02-10" },
    { name: "Trá»ng Tuyá»n", img: "image/tuyen.jpg", date: "2004-01-31" }
];

const letterText = `Gá»­i Thá»§y Linh â€“ Ä‘á»©a báº¡n thÃ¢n ngá»‘c ngháº¿ch nháº¥t mÃ  tao tá»«ng thÆ°Æ¡ng,

HÃ´m nay lÃ  sinh nháº­t mÃ y, vÃ  tao nghÄ© náº¿u khÃ´ng viáº¿t cho mÃ y vÃ i dÃ²ng thÃ¬ Ä‘Ãºng lÃ  thiáº¿u sÃ³t lá»›n trong cuá»™c Ä‘á»i tao. VÃ¬ tháº­t lÃ²ng mÃ  nÃ³i, khÃ´ng pháº£i ai cÅ©ng cÃ³ may máº¯n cÃ³ má»™t ngÆ°á»i báº¡n vá»«a Ä‘áº§n, vá»«a ngá»‘c, vá»«a hÃ i hÆ°á»›c, láº¡i vá»«a khiáº¿n ngÆ°á»i khÃ¡c khÃ´ng thá»ƒ khÃ´ng quÃ½ nhÆ° mÃ y.

Tao khÃ´ng nhá»› chÃ­nh xÃ¡c tá»¥i mÃ¬nh thÃ¢n nhau tá»« khi nÃ o, chá»‰ nhá»› lÃ  cÃ ng ngÃ y tao cÃ ng quen vá»›i hÃ¬nh áº£nh má»™t Thá»§y Linh ráº¥t Ä‘áº·c trÆ°ng: suy nghÄ© thÃ¬ Ä‘Æ¡n giáº£n, pháº£n á»©ng thÃ¬ cháº­m cháº­m, nÃ³i chuyá»‡n nhiá»u lÃºc ngÆ¡ ngÃ¡c nhÆ° chÆ°a hiá»ƒu chuyá»‡n Ä‘á»i. CÃ³ nhá»¯ng khoáº£nh kháº¯c tao nhÃ¬n mÃ y mÃ  chá»‰ biáº¿t báº­t cÆ°á»i, tá»± há»i khÃ´ng hiá»ƒu sao trÃªn Ä‘á»i láº¡i cÃ³ má»™t Ä‘á»©a ngá»‘c má»™t cÃ¡ch tá»± nhiÃªn Ä‘áº¿n váº­y. NhÆ°ng cÅ©ng chÃ­nh sá»± ngá»‘c ngháº¿ch Ä‘Ã³ lÃ m cho mÃ y trá»Ÿ nÃªn khÃ¡c biá»‡t vÃ  Ä‘Ã¡ng yÃªu theo má»™t cÃ¡ch ráº¥t riÃªng.

MÃ y lÃ  kiá»ƒu ngÆ°á»i khÃ´ng cáº§n cá»‘ gáº¯ng Ä‘á»ƒ gÃ¢y cÆ°á»i, nhÆ°ng láº¡i luÃ´n lÃ m ngÆ°á»i khÃ¡c vui. Nhá»¯ng cÃ¢u nÃ³i vÃ´ tri, nhá»¯ng hÃ nh Ä‘á»™ng tráº» con, nhá»¯ng láº§n pháº£n á»©ng sai sai cá»§a mÃ y â€“ táº¥t cáº£ Ä‘á»u vÃ´ tÃ¬nh trá»Ÿ thÃ nh niá»m vui cho nhá»¯ng ngÆ°á»i á»Ÿ cáº¡nh. CÃ³ lÃºc mÃ y nhÆ° má»™t Ä‘á»©a tráº» chÆ°a ká»‹p lá»›n, luÃ´n sá»‘ng báº±ng cáº£m xÃºc, báº±ng sá»± chÃ¢n thÃ nh, khÃ´ng che giáº¥u, khÃ´ng phÃ²ng bá»‹. VÃ  giá»¯a má»™t tháº¿ giá»›i mÃ  ai cÅ©ng pháº£i há»c cÃ¡ch Ä‘á»ƒ phÃ²ng nhau, thÃ¬ sá»± trong tráº»o Ä‘Ã³ cá»§a mÃ y tháº­t sá»± ráº¥t quÃ½ giÃ¡.

Tao biáº¿t mÃ y khÃ´ng pháº£i lÃºc nÃ o cÅ©ng vui. Äáº±ng sau cÃ¡i váº» ngoÃ i ngá»‘c ngháº¿ch vÃ  hay cÆ°á»i áº¥y, mÃ y cÅ©ng cÃ³ nhá»¯ng lÃºc buá»“n, nhá»¯ng lÃºc tá»§i thÃ¢n, nhá»¯ng lÃºc cáº£m tháº¥y mÃ¬nh khÃ´ng Ä‘á»§ tá»‘t. NhÆ°ng mÃ y hiáº¿m khi nÃ³i ra, mÃ  thÆ°á»ng chá»n cÃ¡ch cÆ°á»i cho qua, giáº£ vá» nhÆ° khÃ´ng cÃ³ gÃ¬. ChÃ­nh Ä‘iá»u Ä‘Ã³ khiáº¿n tao thÆ°Æ¡ng mÃ y nhiá»u hÆ¡n, vÃ¬ mÃ y máº¡nh máº½ theo má»™t cÃ¡ch ráº¥t láº·ng láº½.

Cáº£m Æ¡n mÃ y vÃ¬ Ä‘Ã£ lÃ  má»™t ngÆ°á»i báº¡n ráº¥t tháº­t trong cuá»™c Ä‘á»i tao. Cáº£m Æ¡n vÃ¬ Ä‘Ã£ khÃ´ng thay Ä‘á»•i Ä‘á»ƒ trá»Ÿ nÃªn "khÃ´n ngoan" hÆ¡n theo cÃ¡ch cá»§a ngÆ°á»i lá»›n, mÃ  váº«n giá»¯ Ä‘Æ°á»£c nÃ©t tráº» con, ngá»‘c ngháº¿ch nhÆ°ng tá»­ táº¿. Cáº£m Æ¡n vÃ¬ nhá»¯ng láº§n á»Ÿ bÃªn nhau, dÃ¹ cháº³ng lÃ m gÃ¬ lá»›n lao, nhÆ°ng chá»‰ cáº§n cÃ³ mÃ y lÃ  má»i thá»© cÅ©ng trá»Ÿ nÃªn dá»… chá»‹u hÆ¡n ráº¥t nhiá»u.

Sinh nháº­t nÃ y, tao mong mÃ y sáº½ luÃ´n Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng Ä‘Ãºng vá»›i con ngÆ°á»i cá»§a mÃ y. Mong mÃ y váº«n ngá»‘c ngháº¿ch vá»«a Ä‘á»§ Ä‘á»ƒ giá»¯ Ä‘Æ°á»£c sá»± Ä‘Ã¡ng yÃªu, nhÆ°ng cÅ©ng Ä‘á»§ máº¡nh máº½ Ä‘á»ƒ báº£o vá»‡ báº£n thÃ¢n. Mong mÃ y cÆ°á»i nhiá»u hÆ¡n, buá»“n Ã­t hÆ¡n, vÃ  náº¿u cÃ³ buá»“n thÃ¬ nhá»› ráº±ng luÃ´n cÃ³ tao á»Ÿ Ä‘Ã¢y, sáºµn sÃ ng nghe mÃ y nÃ³i nhá»¯ng Ä‘iá»u ngá»› ngáº©n nháº¥t.

ChÃºc má»«ng sinh nháº­t Thá»§y Linh. Cáº£m Æ¡n vÃ¬ Ä‘Ã£ xuáº¥t hiá»‡n trong cuá»™c Ä‘á»i tao vá»›i tÆ° cÃ¡ch lÃ  má»™t ngÆ°á»i báº¡n khÃ´ng hoÃ n háº£o, nhÆ°ng khÃ´ng thá»ƒ thay tháº¿. ğŸ’›ğŸ‚`;

let currentStep = 0;
let typingInterval;

// HÃ m tung phÃ¡o hoa vÃ  hiá»‡u á»©ng chÃºc má»«ng
function celebrate() {
    const duration = 10 * 1000;
    const animationEnd = Date.now() + duration;
    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1000 };

    function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
    }

    const interval = setInterval(function() {
        const timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
            return clearInterval(interval);
        }

        const particleCount = 50 * (timeLeft / duration);
        
        // PhÃ¡o hoa tá»« hai bÃªn
        confetti(Object.assign({}, defaults, { 
            particleCount, 
            origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } 
        }));
        confetti(Object.assign({}, defaults, { 
            particleCount, 
            origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } 
        }));
        
        // Hiá»‡u á»©ng bong bÃ³ng/tim á»Ÿ giá»¯a
        confetti({
            ...defaults,
            particleCount: 15,
            scalar: 1.2,
            shapes: ['circle'],
            colors: ['#ff4d91', '#ff75a0', '#ffffff'],
            origin: { y: 0.7 }
        });
    }, 250);
}

function updateModal() {
    const container = document.getElementById('modalContainer');
    const contentBox = container.querySelector('.modal-content-box');

    if (currentStep < friends.length) {
        // Reset animation Ä‘á»ƒ má»—i láº§n hiá»‡n modal má»›i sáº½ cÃ³ hiá»‡u á»©ng "ná»•i lÃªn"
        contentBox.style.animation = 'none';
        contentBox.offsetHeight; 
        contentBox.style.animation = null;

        const friend = friends[currentStep];
        document.getElementById('modalHeader').innerText = `ğŸ” XÃ¡c Thá»±c BÆ°á»›c ${currentStep + 1}/5`;
        document.getElementById('friendImg').src = friend.img;
        document.getElementById('friendName').innerText = `Nháº­p Sinh Nháº­t ${friend.name}`;
        document.getElementById('dateInput').value = "";
        document.getElementById('errorMsg').innerText = "";
        container.style.display = 'flex';
    } else {
        document.getElementById('modalContainer').style.display = 'none';
        document.getElementById('letterModal').style.display = 'flex';
    }
}

document.getElementById('openBtn').onclick = () => {
    currentStep = 0;
    updateModal();
};

// NÃºt Ä‘Ã³ng modal
document.querySelectorAll('.close-modal').forEach(btn => {
    btn.onclick = () => {
        document.getElementById('modalContainer').style.display = 'none';
        document.getElementById('letterModal').style.display = 'none';
        clearInterval(typingInterval);
    };
});

document.getElementById('confirmBtn').onclick = () => {
    const inputDate = document.getElementById('dateInput').value;
    const dateInput = document.getElementById('dateInput');
    const contentBox = document.querySelector('.modal-content-box');
    const error = document.getElementById('errorMsg');

    if (inputDate === friends[currentStep].date) {
        // Náº¿u Ä‘Ãºng: XÃ³a bá» cÃ¡c hiá»‡u á»©ng lá»—i vÃ  chuyá»ƒn bÆ°á»›c
        dateInput.classList.remove('input-error');
        error.innerText = "";
        currentStep++;
        updateModal();
    } else {
        // Náº¿u sai:
        error.innerText = "â¤ï¸ Nháº­p sai ngÃ y sinh rÃ¹i, thá»­ láº¡i nhÃ©!";
        
        // ThÃªm class rung vÃ  viá»n Ä‘á»
        dateInput.classList.add('input-error');
        contentBox.style.animation = 'none';
        contentBox.offsetHeight; // trigger reflow
        contentBox.style.animation = 'shake 0.4s ease-in-out';

        // XÃ³a hiá»‡u á»©ng rung sau khi cháº¡y xong Ä‘á»ƒ cÃ³ thá»ƒ báº¥m láº¡i láº§n sau
        setTimeout(() => {
            dateInput.classList.remove('input-error');
        }, 500);
    }
};

function startTyping() {
    const display = document.getElementById('letterContent');
    document.getElementById('startBtn').style.display = 'none';
    document.getElementById('showAllBtn').style.display = 'inline-block';
    
    let i = 0;
    display.innerText = "";
    clearInterval(typingInterval);
    typingInterval = setInterval(() => {
        if (i < letterText.length) {
            display.innerText += letterText[i];
            i++;
            display.scrollTop = display.scrollHeight;
        } else {
            clearInterval(typingInterval);
            celebrate(); // Tung phÃ¡o hoa khi gÃµ xong
        }
    }, 45);
}

document.getElementById('startBtn').onclick = startTyping;

document.getElementById('showAllBtn').onclick = () => {
    clearInterval(typingInterval);
    document.getElementById('letterContent').innerText = letterText;
    document.getElementById('showAllBtn').style.display = 'none';
    celebrate(); // Tung phÃ¡o hoa khi hiá»‡n táº¥t cáº£
};